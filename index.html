<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SafeGain - AI 增重助手</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="apple-touch-icon" href="icon.svg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2E7D32">

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://lib.baomitu.com/font-awesome/6.4.2/css/all.min.css">

    <script src="https://lib.baomitu.com/dexie/3.2.4/dexie.min.js"></script>
    <script src="https://lib.baomitu.com/Chart.js/4.4.0/chart.umd.js"></script>
    <script src="https://lib.baomitu.com/browser-image-compression/2.0.2/browser-image-compression.js"></script>
</head>

<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1><i class="fas fa-heartbeat"></i> SafeGain</h1>
                <div class="breathing-reminder">
                    <i class="fas fa-wind"></i> 呼气发力 · 吸气还原
                </div>
            </div>
        </header>

        <main class="app-main">
            <div class="tab-content active" id="diet-tab">
                <div class="card meal-analysis-section">
                    <div class="section-header">
                        <h2><i class="fas fa-camera-retro"></i> AI 饮食分析</h2>
                    </div>

                    <div class="camera-section">
                        <button id="capture-btn" class="primary-btn pulse-effect">
                            <i class="fas fa-camera"></i> 拍食物 / 选图片
                        </button>
                        <input type="file" id="file-input" accept="image/*" capture="environment"
                            style="display: none;">
                    </div>

                    <div id="image-preview" class="image-preview-container" style="display: none;">
                        <img id="preview-img" src="" alt="食物预览">
                        <button id="analyze-btn" class="primary-btn">
                            <i class="fas fa-microscope"></i> 开始 AI 分析
                        </button>
                    </div>

                    <div id="analysis-result" class="analysis-card" style="display: none;">
                    </div>
                </div>

                <div class="card meal-record-section">
                    <div class="section-header">
                        <h2><i class="fas fa-edit"></i> 用餐感受</h2>
                    </div>
                    <div class="form-group">
                        <label><i class="far fa-clock"></i> 时间</label>
                        <input type="datetime-local" id="meal-time" class="form-input">
                    </div>

                    <div class="form-group">
                        <label>胃部感觉</label>
                        <div class="radio-group-modern">
                            <label class="radio-card success">
                                <input type="radio" name="stomach-feeling" value="comfortable">
                                <span class="icon"><i class="far fa-smile"></i></span>
                                <span>舒适</span>
                            </label>
                            <label class="radio-card warning">
                                <input type="radio" name="stomach-feeling" value="bloating">
                                <span class="icon"><i class="far fa-meh"></i></span>
                                <span>胀气</span>
                            </label>
                            <label class="radio-card danger">
                                <input type="radio" name="stomach-feeling" value="reflux">
                                <span class="icon"><i class="far fa-frown"></i></span>
                                <span>反酸</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>备注</label>
                        <textarea id="meal-notes" class="form-textarea" placeholder="今天胃口怎么样？"></textarea>
                    </div>

                    <button id="save-meal-btn" class="secondary-btn full-width">
                        <i class="fas fa-check"></i> 保存记录
                    </button>
                </div>
            </div>

            <div class="tab-content" id="workout-tab">
                <div class="card workout-section">
                    <div class="safety-banner">
                        <i class="fas fa-shield-alt"></i>
                        <span>安全提示：避免平躺，保持头部抬高</span>
                    </div>

                    <div class="form-group">
                        <label>运动项目</label>
                        <select id="exercise-type" class="form-select">
                            <option value="">选择安全动作...</option>
                            <option value="incline-dumbbell-press">上斜哑铃卧推 (防反流)</option>
                            <option value="seated-press">坐姿推举 (护腰背)</option>
                            <option value="goblet-squat">高脚杯深蹲 (低腹压)</option>
                            <option value="lateral-raise">哑铃侧平举</option>
                            <option value="bicep-curl">二头弯举</option>
                        </select>
                    </div>

                    <div class="workout-inputs-row">
                        <div class="form-group">
                            <label>组数</label>
                            <input type="number" id="workout-sets" class="form-input" value="3">
                        </div>
                        <div class="form-group">
                            <label>次数/组</label>
                            <input type="number" id="workout-reps" class="form-input" value="10">
                        </div>
                        <div class="form-group">
                            <label>重量(kg)</label>
                            <input type="number" id="workout-weight" class="form-input" value="5">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>时间</label>
                        <input type="datetime-local" id="workout-time" class="form-input">
                    </div>

                    <div class="form-group">
                        <label>感受</label>
                        <textarea id="workout-notes" class="form-textarea" placeholder="有力竭感吗？有无不适？"></textarea>
                    </div>

                    <button id="save-workout-btn" class="primary-btn full-width">
                        <i class="fas fa-dumbbell"></i> 打卡完成
                    </button>
                </div>
            </div>

            <div class="tab-content" id="stats-tab">
                <div class="card stats-section">
                    <div class="calendar-module">
                        <h3><i class="fas fa-calendar-check"></i> 本月运动打卡</h3>
                        <div id="workout-calendar" class="calendar-grid">
                        </div>
                    </div>

                    <div class="weight-module">
                        <h3><i class="fas fa-weight"></i> 体重追踪</h3>
                        <div class="input-with-btn">
                            <input type="number" id="weight-input" class="form-input" placeholder="kg" step="0.1">
                            <input type="date" id="weight-date" class="form-input">
                            <button id="save-weight-btn" class="primary-btn small">记录</button>
                        </div>
                    </div>

                    <div class="charts-wrapper">
                        <div class="chart-box">
                            <canvas id="weight-chart"></canvas>
                        </div>
                        <div class="chart-box" style="margin-top: 1rem; display:none;">
                            <canvas id="stomach-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="profile-tab">
                <div class="card profile-section">
                    <div class="profile-header">
                        <div class="avatar-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                        <h3>个人健康档案</h3>
                        <p class="subtitle">配置您的专属 AI 营养师</p>
                    </div>

                    <div class="settings-group">
                        <h4><i class="fas fa-key"></i> 接口配置 (API)</h4>
                        <div class="form-group">
                            <label>Endpoint ID (接入点)</label>
                            <input type="text" id="endpoint-input" class="form-input" placeholder="火山引擎 Endpoint ID">
                        </div>
                        <div class="form-group">
                            <label>API Key (密钥)</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="api-key-input" class="form-input" placeholder="sk-...">
                                <i class="fas fa-eye toggle-password" id="toggle-api-key"></i>
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="group-header">
                            <h4><i class="fas fa-id-card-alt"></i> 健康档案 (Prompt Context)</h4>
                            <button id="reset-prompt-btn" class="text-btn">恢复默认</button>
                        </div>
                        <p class="helper-text" style="font-size:0.8rem; color:#888; margin-bottom:0.5rem;">请描述身体状况，AI
                            将据此分析：</p>
                        <textarea id="user-prompt-input" class="form-textarea code-font" rows="5"></textarea>
                    </div>

                    <button id="save-profile-btn" class="primary-btn full-width">
                        <i class="fas fa-save"></i> 保存全部设置
                    </button>

                    <div class="privacy-note">
                        <i class="fas fa-shield-alt"></i>
                        <p>承诺：所有数据（Key、档案、记录）仅存储在您的本地浏览器，绝不上传云端。</p>
                    </div>

                    <div class="version-info">SafeGain v2.1</div>
                </div>
            </div>
        </main>

        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="diet">
                <i class="fas fa-utensils"></i>
                <span>饮食</span>
            </button>
            <button class="tab-btn" data-tab="workout">
                <i class="fas fa-dumbbell"></i>
                <span>运动</span>
            </button>
            <button class="tab-btn" data-tab="stats">
                <i class="fas fa-chart-line"></i>
                <span>统计</span>
            </button>
            <button class="tab-btn" data-tab="profile">
                <i class="fas fa-user"></i>
                <span>我的</span>
            </button>
        </nav>
    </div>

    <div id="notification" class="notification" style="display: none;">
        <div class="notification-content">
            <i class="fas fa-info-circle"></i>
            <p id="notification-text"></p>
        </div>
    </div>

    <div id="risk-alert" class="risk-alert" style="display: none;">
        <div class="risk-alert-content">
            <div class="alert-icon-wrapper"><i class="fas fa-exclamation-triangle"></i></div>
            <h3>饮食风险提示</h3>
            <p id="risk-message"></p>
            <button id="acknowledge-risk" class="alert-btn">我已了解</button>
        </div>
    </div>

    <div id="reflux-reminder" class="reflux-reminder" style="display: none;">
        <div class="reminder-content">
            <i class="fas fa-bed"></i>
            <h3>睡眠建议</h3>
            <p>检测到反酸风险，今晚请尝试<strong>垫高上半身 15-20cm</strong> 入睡。</p>
            <button id="acknowledge-reminder" class="primary-btn">好的</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>